Predix WTS Turbine Data Simulator App
==============

Welcome to the Predix WTS Turbine Data Simulator Application

## Overview
Predix WTS Turbine Data Simulator (WTS Simulator) is a cloud web application which simulates the power meter generated by wind turbines. When WTS Simulator online, it periodically checks with Predix Asset whether the service has new turbines' information.  This application works closely with the following predix services:
- Predix UAA
- Predix Asset

## Environment
Before starting with the application, we need to prepare the working environment as following:
- Predix UAA: https://www.predix.io/docs#XpKGAdQ7-ao7RnIco
- Predix Asset: https://www.predix.io/docs#aRPNr2R9
- Endpoint server to receive simulated data

## Application Installation
WTS Simulator requires Java 8 and Maven 3.x in order to build it correctly.

1. Clone the github repository to your machine
  ```
  git clone https://github.com/PredixSolutions/predix-wts-app/tree/feature_phase2/predix-wts-turbine-datasimulator
  
  cd predix-wts-turbine-datasimulator
  ```
2. Update manifest.yml


  ```
  applications:
  - name: <app_name>
    buildpack: java_buildpack
    memory: 2G
    instances: '1'
    path: target/predix-wts-turbine-datasimulator-0.0.1-SNAPSHOT.jar
    services:
      - <predix-uaa-service-name>
      - <predix-asset-service-name>
    env:
      PREDIX_UAA_NAME: <predix-uaa-service-name>
      PREDIX_ASSET_NAME: <predix-asset-service-name>
      CLIENT_ID: <client_id>
      CLIENT_SECRET: <client_password>
      CLIENT_BASE64_TOKEN: <base64 of client_id:client_password>
      UAA_URI: '<Predix UAA instance URI>'
      UAA_INSTANCE_ID: <Predix UAA instance ID>
      ASSET_URI: '<Predix Asset instance URI>'
      ASSET_INSTANCE_ID: <Predix Asset instance ID>
      GATEWAY_URI: '<Gateway_URI>'
  ```
  
  Gateway URI is the HTTP/HTTPS address of the data consumer. WTS Simulator will send timeseries data to **`<Gateway_URI>/queues`**
  
3. Update src/main/resources/application.yml
  
  Change properties in section __profiles: cloud__ if you want to run the app on cloud or __profiles: dev__ if you want to     run the app on your own server.

  ```
  spring:
  profiles: cloud
  
  uaa:
    clientId: ${CLIENT_ID}
    clientSecret: ${CLIENT_SECRET}
    clientBase64Token: ${CLIENT_BASE64_TOKEN}
    uri: ${UAA_URI}
    
  gatewayAPI:
    uri: ${GATEWAY_URI}
    
  timeseries:
    updateTurbineInterval: <update turbines information interval in milliseconds>
    generateDataInterval: <data generation interval in milliseconds>
    httpReadTimeout: 2000
    httpConnTimeout: 2000
    deltaValue: <variation of generated value>
  
  asset:
    instanceId: ${ASSET_INSTANCE_ID}
    uri: ${ASSET_URI}
  ```
  
4. Build application

  ```mvn clean install```
  
5. Deploy application to Predix cloud

  ```cf push```

## Data Generation

Running data generation requires 2 factors:
- Turbine asset in Predix Asset 
- Endpoint service

1. Add new turbine to Predix Asset with the following template model

  ```
  [
    {
      "uri": "/turbines/1458177224678",
      "id": 1458177224678,
      "name": "Turbine 1",
      "status": "error",
      "active": true,
      "minPower": 80,
      "maxPower": 100,
      "activeDuration": 0,
      "exceptionModeEnabled": true,
      "overModeEnabled": false,
      "notificationEnabled": false
    },
    {
      "uri": "/turbines/1458177646626",
      "id": 1458177646626,
      "name": "Tubrine 2",
      "status": "normal",
      "active": true,
      "minPower": 80,
      "maxPower": 100,
      "activeDuration": 0,
      "exceptionModeEnabled": true,
      "overModeEnabled": true,
      "notificationEnabled": false
    }
  ]
  ```
  
  Fields explanation:
  1. uri: unique asset uri which is composed of /turbines model and its ID
  2. id: unique identifier of the turbine
  3. name: name of the turbine
  4. status: normal/error
  5. active: true/false (**true** to generate data)
  6. minPower: the minimum value of generated data point
  7. maxPower: the maximum value of generated data point
  8. exceptionModeEnabled: true/false (**true** to generate data lower than minPower)
  9. overModeEnabled: true/false (**true** to generate data higher than maxPower)
  10. notificationEnabled: true/false (**true** to trigger Event Brokers app notifying UI)
  
2. Prepare endpoint service

- HTTP Method: POST
- Content-type: application/json
- Headers (optional):

  ```
  Authorization: 'Bearer ' + <client_token>
  ```
  
- Data template:

  ```
  {
    "name": "turbine1",
    "datapoints": [
      [
        1459297369006,
        82.083249243192896,
        3
      ]
    ],
    "attributes": {
      "location": "US",
      "manufacturer": "FORD"
    }
  }
  ```

Endpoint server will receive data from WTS Simulator periodically. Number of data point that WTS Simulator sends each cycle is the same number of **active** turbine getting from Predix Asset.


